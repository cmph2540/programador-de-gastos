<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="public/favicon.png" />
  <link rel="stylesheet" href="styles.css" />
  <title>Programador de Gastos</title>
</head>
<body>
  <header>
    <div class="logo">
      <svg viewBox="0 0 24 24" fill="none"><path d="M4 12c0-4.418 3.582-8 8-8a8 8 0 010 16c-4.418 0-8-3.582-8-8z" stroke="#4fc3f7" stroke-width="2"/><path d="M8 12a4 4 0 018 0" stroke="#22c55e" stroke-width="2"/></svg>
      Programador de Gastos
    </div>
    
    <button class="menu-toggle" id="menuToggle" aria-label="Abrir menú">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 6h16M4 12h16M4 18h16" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>

    <nav id="mainNav">
      <button class="tab active" data-tab="entrada">Ingresos y Gastos</button>
      <button class="tab" data-tab="resumen">Resumen</button>
      <button class="tab" data-tab="ahorros">Plan de Ahorros</button>
      <button class="tab" data-tab="inversiones">Inversiones</button>
      
      <button class="btn warn reset-data-btn" id="btnResetData">
        <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M3 3l18 18M3 21L21 3" stroke="#f59e0b" stroke-width="2"/></svg>
        Restablecer Datos
      </button>
    </nav>
  </header>

  <div class="container">
    <div class="tip">
      <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 2v3M5.2 7.2l2.1 2.1M2 12h3M7.2 18.8l2.1-2.1M12 19v3M18.8 16.8l-2.1-2.1M19 12h3M16.8 7.2l-2.1 2.1" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"/></svg>
      <span id="tipText"></span>
    </div>
    <br>
    <!-- ENTRADA -->
    <section id="entrada" class="entrada-grid" role="region" aria-label="Entrada de ingresos y gastos">
      <!-- INGRESOS -->
      <div class="card ingresos">
        <h3>Ingresos</h3>
        <div class="row">
          <div class="field">
            <label>Categoría</label>
            <select id="ingresoCategoria"></select>
            <div id="ingresoCreateBox" class="inline-create" aria-expanded="false">
              <input id="ingresoNewConcept" class="input" type="text" placeholder="Nuevo concepto de ingreso" />
              <button id="btnIngresoAddConcept" class="btn primary">Agregar</button>
              <button id="btnIngresoCancelConcept" class="btn ghost">Cancelar</button>
            </div>
          </div>
          <div class="field">
            <label>Valor (COP)</label>
            <input id="ingresoValor" class="input" type="number" inputmode="numeric" min="0" step="1" placeholder="0" />
          </div>
          <div class="field" style="align-self:flex-end;">
            <button id="btnAddIngreso" class="btn primary">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="#4fc3f7" stroke-width="2" stroke-linecap="round"/></svg>
              Agregar ingreso
            </button>
          </div>
        </div>

        <div class="table-wrap">
          <table id="tablaIngresos">
            <thead><tr><th>Concepto</th><th class="right">Valor</th><th class="right">Acciones</th></tr></thead>
            <tbody></tbody>
            <tfoot>
              <tr><th>Total Ingresos</th><th class="right" id="totalIngresos">COP 0</th><th></th></tr>
            </tfoot>
          </table>
        </div>
      </div>

      <!-- RESUMEN -->
      <div class="card compacto resumen-mes">
        <h3>Resumen del mes</h3>
        <div class="row">
          <div class="field">
            <label>Saldo = Ingresos – Gastos</label>
            <div id="saldoChip" class="chip ok">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#22c55e" stroke-width="2"/></svg>
              <span id="saldoTexto">COP 0</span>
            </div>
          </div>
          <div class="field">
            <label>Liquidez = Dinero / Total ingresos</label>
            <div class="bar"><div id="liqFill" class="fill liq" style="width:0%"></div></div>
            <div class="muted" id="liqTexto">0%</div>
          </div>
          <div class="field">
            <label>Gastos (%) = 100% – Liquidez</label>
            <div class="bar"><div id="expFill" class="fill exp" style="width:0%"></div></div>
            <div class="muted" id="expTexto">0%</div>
          </div>
        </div>

        <div id="alertaLiquidez" class="alert" style="display:none;">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 8v6M12 18h0" stroke="#f59e0b" stroke-width="2"/></svg>
          <span id="alertaLiquidezTexto">Advertencia de liquidez…</span>
        </div>

        <div class="row" style="margin-top:.45rem;">
          <div class="field">
            <button id="btnGuardarMes" class="btn secondary">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#4fc3f7" stroke-width="2"/></svg>
              Guardar solo este mes
            </button>
          </div>
          <div class="field">
            <!-- CORRECCIÓN 3: Botón "Guardar y crear 12 meses" con clase condicional -->
            <button id="btnGuardar" class="btn success">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#22c55e" stroke-width="2"/></svg>
              Guardar y crear 12 meses
            </button>
          </div>

          <div class="field" style="align-self:flex-end">
            <button id="btnEditarMes" class="btn secondary">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M4 20h4l10-10-4-4L4 16v4z" stroke="#4fc3f7" stroke-width="2"/></svg>
              Editar mes
            </button>
          </div>
          <div class="field">
            <label>Selecciona mes a editar</label>
            <select id="mesSelector" disabled></select>
          </div>
          <div class="field edit-info" id="mesEditInfo">
            <label>Mes en edición</label>
            <div id="mesEditChip" class="chip edit">Editando: —</div>
          </div>

          <div class="field" id="primaField" style="display:none">
            <label>
              <input type="checkbox" id="chkPrima" />
              Prima (50% del salario) — Junio y Diciembre
            </label>
          </div>
        </div>
      </div>

      <!-- GASTOS -->
      <div class="card gastos">
        <h3>Gastos</h3>

        <div class="donut-header">
          <!-- Donut Pagado -->
          <div class="donut-box">
            <!-- CORRECCIÓN 1: Contenedor alternativo para un solo dato -->
            <div id="singleDataContainer" class="single-data-display" style="display:none;">
              <div id="singleDataValue" class="single-data-value">0%</div>
              <div id="singleDataLabel" class="single-data-label">Pagado</div>
            </div>
            <svg class="donut" id="donutPaidSvg" viewBox="0 0 140 140" aria-label="Progreso de pagos">
              <circle cx="70" cy="70" r="60" stroke="#1c2940" stroke-width="16" fill="none"/>
              <circle id="donutPaid" cx="70" cy="70" r="60" stroke="#22c55e" stroke-width="16" fill="none"
                      stroke-linecap="round" stroke-dasharray="377" stroke-dashoffset="377"
                      transform="rotate(-90 70 70)"/>
              <circle cx="70" cy="70" r="38" fill="#0b1323" stroke="#16233f" stroke-width="1"/>
              <text id="donutCenterPct" x="70" y="70" text-anchor="middle" dominant-baseline="middle"
                    font-size="16" font-weight="700" fill="#eaf1f9">0%</text>
            </svg>
            <div class="donut-labels">
              <div id="donutPct" class="chip ok">0% pagado</div>
              <div class="legend"><span class="box" style="background:#22c55e"></span><span>Pagado</span></div>
              <div class="legend"><span class="box" style="background:#4fc3f7"></span><span>Pendiente</span></div>
              <div class="muted" id="donutAmounts">COP 0 / COP 0</div>
            </div>
          </div>

          <!-- Donut Categorías -->
          <div class="donut-box">
            <!-- CORRECCIÓN 1: Contenedor alternativo para un solo dato de categorías -->
            <div id="singleCatDataContainer" class="single-data-display" style="display:none;">
              <div id="singleCatDataValue" class="single-data-value">100%</div>
              <div id="singleCatDataLabel" class="single-data-label">Categoría</div>
            </div>
            <svg class="donut" id="catDonutSvg" viewBox="0 0 140 140" aria-label="Distribución por tipo">
              <g id="catDonutSegs" transform="rotate(-90 70 70)"></g>
              <circle cx="70" cy="70" r="38" fill="#0b1323" stroke="#16233f" stroke-width="1"/>
              <text id="catDonutCenter" x="70" y="70" text-anchor="middle" dominant-baseline="middle"
                    font-size="13" font-weight="700" fill="#eaf1f9">Por tipo</text>
            </svg>
            <div class="donut-labels">
              <div class="legend">
                <div class="legend-columns">
                  <div id="catLegendCol1" class="legend-col"></div>
                  <div id="catLegendCol2" class="legend-col"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form gastos -->
        <div class="row">
          <div class="field">
            <label>Descripción (máx. 30)</label>
            <input id="gastoDesc" class="input" type="text" maxlength="30" placeholder="Ej. Celular / Mercado / SOAT…" />
          </div>
          <div class="field">
            <label>Tipo de gasto</label>
            <select id="gastoTipo"></select>
            <div id="gastoTipoCreateBox" class="inline-create" aria-expanded="false">
              <input id="gastoNewTipo" class="input" type="text" placeholder="Nuevo tipo de gasto" />
              <button id="btnGastoAddTipo" class="btn primary">Agregar</button>
              <button id="btnGastoCancelTipo" class="btn ghost">Cancelar</button>
            </div>
          </div>
          <div class="field">
            <label>Valor total (COP)</label>
            <input id="gastoValor" class="input" type="number" inputmode="numeric" min="0" step="1" placeholder="0" />
          </div>
          <div class="field">
            <label><input type="checkbox" id="chkGastoCuotas" /> ¿Gasto en cuotas?</label>
            <input id="gastoCuotas" class="input" type="number" min="2" step="1" placeholder="N° de cuotas" disabled />
          </div>
          <div class="field" style="align-self:flex-end;">
            <button id="btnAddGasto" class="btn primary">
              <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="#4fc3f7" stroke-width="2" stroke-linecap="round"/></svg>
              Agregar gasto
            </button>
          </div>
        </div>

        <div class="table-wrap">
          <table id="tablaGastos">
            <thead>
              <tr>
                <th>Descripción</th>
                <th>Tipo</th>
                <th class="right">Valor</th>
                <th class="right">% del total</th>
                <th class="right">Pagado</th>
                <th class="right">Acciones</th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr><th>Total Gastos</th><th></th><th class="right" id="totalGastos">COP 0</th><th></th><th></th><th></th></tr>
            </tfoot>
          </table>
        </div>
      </div>
    </section>

    <!-- Resumen -->
    <section id="resumen" class="card" style="display:none" role="region" aria-label="Resumen anual">
      <h3>Resumen mensual (orden Enero a Diciembre por año)</h3>
      <div class="table-wrap">
        <table id="tablaResumen">
          <thead>
            <tr>
              <th>Mes</th>
              <th class="right">Dinero (Saldo)</th>
              <th>Liquidez</th>
              <th>Gastos (%)</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Ahorros -->
    <section id="ahorros" class="card" style="display:none" role="region" aria-label="Plan de ahorros">
      <h3>Plan de ahorros</h3>

      <div class="row" style="margin-bottom: 1rem; align-items: flex-end;">
        <div class="field" style="max-width: 200px;">
          <label>Elige tu alcancía</label>
          <select id="ahorroGraficaEstilo">
            <option value="jar" selected>Frasco de Vidrio</option>
            <option value="pig">Marranito</option>
            <option value="chest">Cofre del Tesoro</option>
          </select>
        </div>
        <div class="field" style="max-width: 140px;">
          <label>Meta (%)</label>
          <input id="ahorroMetaPct" class="input" type="number" min="10" max="100" step="1" value="100" />
        </div>
      </div>

      <div class="bank-wrap">
        <svg class="bank" viewBox="0 0 200 160" aria-label="Ahorro acumulado">
          <defs>
            <linearGradient id="liquidGrad" x1="0" x2="0" y1="1" y2="0">
              <stop offset="0%" stop-color="#10b981" /> <stop offset="100%" stop-color="#3b82f6" /> </linearGradient>

            <clipPath id="clipJar">
              <path d="M65,40 L135,40 L135,50 C145,52 155,65 155,95 C155,130 145,145 100,145 C55,145 45,130 45,95 C45,65 55,52 65,50 Z" />
            </clipPath>

            <clipPath id="clipPig">
              <path d="M40,90 C40,70 60,50 100,50 C130,50 150,65 160,85 C160,105 145,120 130,120 L130,135 L115,135 L115,125 L85,125 L85,135 L70,135 L70,115 C50,115 40,105 40,90 Z" />
            </clipPath>

            <clipPath id="clipChest">
              <path d="M45,75 L155,75 L155,125 C155,135 145,140 100,140 C55,140 45,135 45,125 Z M45,72 C45,55 70,45 100,45 C130,45 155,55 155,72 Z" />
            </clipPath>
          </defs>

          <g id="bgGroup" opacity="0.2">
            <rect x="0" y="0" width="200" height="160" fill="#1e293b" id="bgRect" style="clip-path: url(#clipJar);" />
          </g>

          <rect id="bankFill" x="0" y="145" width="200" height="0" fill="url(#liquidGrad)" style="clip-path: url(#clipJar); transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1), y 0.6s cubic-bezier(0.4, 0, 0.2, 1);" />

          <g id="bankCoins"></g>

          <g id="visualJar" class="visual-shape" style="display:block;">
            <path d="M65,40 L135,40 L135,50 C145,52 155,65 155,95 C155,130 145,145 100,145 C55,145 45,130 45,95 C45,65 55,52 65,50 Z" fill="none" stroke="#64748b" stroke-width="4"/>
            <path d="M65,40 L135,40 L135,50 C145,52 155,65 155,95 C155,130 145,145 100,145 C55,145 45,130 45,95 C45,65 55,52 65,50 Z" fill="url(#glassGrad)" stroke="#a5b4fc" stroke-width="1.5" opacity="0.8"/>
            <rect x="62" y="32" width="76" height="8" rx="2" fill="#334155" stroke="#94a3b8" stroke-width="1"/>
            <path d="M55,90 Q55,70 65,60" fill="none" stroke="white" stroke-width="2" opacity="0.3" stroke-linecap="round"/>
          </g>

          <g id="visualPig" class="visual-shape" style="display:none;">
            <path d="M75,130 L75,138 L90,138 L90,125" fill="none" stroke="#475569" stroke-width="3"/>
            <path d="M110,125 L110,138 L125,138 L125,130" fill="none" stroke="#475569" stroke-width="3"/>
            
            <path d="M40,90 C40,70 60,50 100,50 C130,50 150,65 160,85 C160,105 145,120 130,120 L130,135 L115,135 L115,125 L85,125 L85,135 L70,135 L70,115 C50,115 40,105 40,90 Z" fill="none" stroke="#f472b6" stroke-width="3"/>
            
            <path d="M70,55 L65,40 L85,50" fill="#1e293b" stroke="#f472b6" stroke-width="2"/>
            
            <ellipse cx="38" cy="82" rx="7" ry="5" fill="#1e293b" stroke="#f472b6" stroke-width="2"/>
            <circle cx="36" cy="82" r="1.2" fill="#f472b6"/>
            <circle cx="40" cy="82" r="1.2" fill="#f472b6"/>

            <circle cx="65" cy="75" r="4" fill="#fff"/>
            <circle cx="65" cy="75" r="1.5" fill="#000"/>
            
            <path d="M160,85 Q175,80 170,70 Q165,65 175,75" fill="none" stroke="#f472b6" stroke-width="2" stroke-linecap="round"/>
          </g>

          <g id="visualChest" class="visual-shape" style="display:none;">
            <path d="M45,75 L155,75 L155,125 C155,135 145,140 100,140 C55,140 45,135 45,125 Z" fill="none" stroke="#d97706" stroke-width="3"/>
            <path d="M45,75 L45,72 C45,55 70,45 100,45 C130,45 155,55 155,72 L155,75 Z" fill="none" stroke="#f59e0b" stroke-width="3"/>
            <circle cx="100" cy="95" r="8" fill="#1e293b" stroke="#f59e0b" stroke-width="2"/>
            <path d="M100,92 L100,98" stroke="#f59e0b" stroke-width="2"/>
            <path d="M60,75 L60,137 M140,75 L140,137" stroke="#b45309" stroke-width="2" fill="none"/>
          </g>

          <line id="bankGoalLine" x1="10" x2="190" y1="50" y2="50" stroke="#fbbf24" stroke-width="2" stroke-dasharray="6 4" />
          <text id="bankCenterText" x="100" y="100" text-anchor="middle" font-size="16" font-weight="800" fill="#fff" style="text-shadow: 0 2px 4px rgba(0,0,0,0.8); pointer-events: none;">0%</text>
        </svg>

        <div class="bank-labels">
          <div id="bankPctChip" class="bank-chip">0% cumplimiento</div>
          <div class="muted" id="bankAmounts">Total ahorrado: COP 0</div>
        </div>
      </div>

      <div class="row">
        <div class="field">
          <label>% Ahorro Global</label>
          <input id="pctAhorroGlobal" class="input" type="number" min="0" max="100" value="25" />
        </div>
        <div class="field">
          <label>% Gasto Global</label>
          <input id="pctGastoGlobal" class="input" type="number" min="0" max="100" value="35" />
        </div>
        <div class="field" style="align-self:flex-end">
          <button id="btnAplicarPorcentajes" class="btn success">
            Aplicar a todos
          </button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="tablaAhorros" class="plan-ahorro-mobile">
          <thead>
            <tr>
              <th>Mes</th>
              <th class="right">Dinero</th>
              <th class="right">% Ahorrar</th>
              <th class="right">Valor Ahorro</th>
              <th class="right">Total Ahorrado</th>
              <th class="right">Confirmar</th>
              <th class="right">% Gastar</th>
              <th class="right">Disp. Gasto</th>
              <th class="right">Restante</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- INVERSIONES -->
    <section id="inversiones" class="card" style="display:none" role="region" aria-label="Inversiones">
      <h3>Inversiones</h3>

      <div class="inv-advices">
        <strong>Consejo de Inversión del día</strong>
        <div id="singleAdviceText" class="advice-text">Cargando consejo...</div>
        <div class="muted" style="margin-top: .5rem; font-size: .85rem;">
        </div>
      </div>

      <div class="inv-header">
        <div class="inv-available-chip">
          <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M5 13l4 4L19 7" stroke="#22c55e" stroke-width="2"/></svg>
          <strong>Dinero disponible (mes actual):</strong> <span id="invDineroDisponible">COP 0</span>
        </div>
        <div class="muted" id="invMesLabel">—</div>
      </div>

      <div class="row" style="margin-top:.45rem">
        <div class="field">
          <label>Concepto</label>
          <select id="invConcepto"></select>
          <div id="invCreateBox" class="inline-create" aria-expanded="false">
            <input id="invNewConcept" class="input" type="text" placeholder="Nuevo concepto de inversión" />
            <button id="btnInvAddConcept" class="btn primary">Agregar</button>
            <button id="btnInvCancelConcept" class="btn ghost">Cancelar</button>
          </div>
        </div>
        <div class="field">
          <label>Valor invertido (COP)</label>
          <input id="invValor" class="input" type="number" min="0" step="1" placeholder="0" />
        </div>
        <div class="field">
          <label>% Rentabilidad esperada (Mensual)</label>
          <input id="invRentMensual" class="input" type="number" min="-100" step="0.01" placeholder="3" />
        </div>
        <div class="field">
          <label><input type="checkbox" id="invCompuesto" /> ¿Interés compuesto?</label>
        </div>
        <div class="field">
          <label>Fecha de inicio (automática)</label>
          <input id="invFechaInicio" class="input" type="text" readonly />
        </div>
        <div class="field">
          <label>Fecha de vencimiento (solo CDT)</label>
          <input id="invVencimiento" class="input" type="date" />
        </div>
        <div class="field" style="align-self:flex-end">
          <button id="btnAddInv" class="btn primary">
            <svg class="icon" viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="#4fc3f7" stroke-width="2" stroke-linecap="round"/></svg>
            Agregar inversión
          </button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="tablaInv">
          <thead>
            <tr>
              <th>Inversión</th>
              <th class="right">Valor</th>
              <th class="right">% Rentabilidad (Mensual)</th>
              <th class="right">Rendimiento mensual</th>
              <th class="right">Total anual</th>
              <th class="right">% participación</th>
              <th class="right">Total (valor + rendimiento)</th>
              <th>Inicio</th>
              <th>Vencimiento</th>
              <th>Estado</th>
              <th class="right">Compuesto</th>
              <th class="right">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <th>Total invertido</th><th class="right" id="totalInvertido">COP 0</th><th></th>
              <th class="right" id="totalRendimientoMensual">COP 0</th>
              <th class="right" id="totalRendimientoAnual">COP 0</th>
              <th></th><th class="right" id="totalInvMasUtilidad">COP 0</th><th></th><th></th><th></th><th></th><th></th>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="chart-wrap">
        <div class="chart-card">
          <div class="chart-title">
            <div><strong>Top 5 por valor</strong><div class="subtitle">Participación sobre el total invertido</div></div>
            <div id="invTotalChip" class="chart-chip">Total invertido: COP 0</div>
          </div>
          <svg id="invTop5Svg" class="inv-chart" viewBox="0 0 520 220" aria-label="Top 5 inversiones por valor" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
      </div>
    </section>
  </div>

  <!-- CORRECCIÓN 4: Modal de confirmación para restablecer datos -->
  <div id="resetModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <svg class="icon" viewBox="0 0 24 24" fill="none" style="width: 24px; height: 24px;">
          <path d="M12 9v2m0 4h0m9-4a9 9 0 11-18 0 9 9 0 0118 0z" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <div class="modal-title">Restablecer todos los datos</div>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro de que deseas restablecer todos los datos? Esta acción:</p>
        <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
          <li>Eliminará todos los ingresos y gastos</li>
          <li>Eliminará todos los meses creados</li>
          <li>Eliminará todas las inversiones</li>
          <li>Restablecerá la aplicación al estado inicial</li>
        </ul>
        <p style="margin-top: 1rem; color: #f59e0b;"><strong>Esta acción no se puede deshacer.</strong></p>
      </div>
      <div class="modal-footer">
        <button id="btnCancelReset" class="btn secondary">Cancelar</button>
        <button id="btnConfirmReset" class="btn btn-destructive">Sí, Restablecer Datos</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" aria-live="polite" aria-atomic="true"></div>
  <script src="app.js"></script>
</body>
</html>